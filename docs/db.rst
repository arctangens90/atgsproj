
Структура баз данных
===========================

Общая информация
-------------------------------

Для корректной работы веб-сервера необходима база данных (БД администрирования), в которой хранится необходимая информация о пользователях, их ролях, а также правах доступа определенных пользователей к определнным html-страницам, и их компонентам. Рабочая СУБД - **PostgreSQL**, база данных содержит 2 схемы :

* **public**
* **admin**


Схема **public**--это схема, создаваемая СУБД по умолчанию, в текущем проекте в ней находятся функции стандартного пакета **pgcrypt**.
Основная же логика сосредоточена в схеме **admin**. Система позволяет подключения также к дополнительным внешним базам данных, но здесь будет рассмотрена основная БД--БД администрирования.

Схема **admin**. Система прав доступа
----------------------------------------

В данной схеме находится основная информация для работы с пользователями, а так же их правами и ролями. Таблица **users** содержит общую информацию о пользователе, информацию об его отделе , его логин и пароль, а также набор дополнительных произвольных параметров, инкапсулированных в *json*. в таблице **departments** содержится информация о подразделениях(отделах), фактически эта таблица является уточняющей для таблицы **users** и не несет логики проекта, однако создана для нужд предпряитий-потенциальных заказчиков. Таблицы **roles** и **userroles** содержат информацию о ролях пользовтаелей и о связях между пользователями и ролями. Именно *роль* является основой для построения системы прав доступа. 

Атомарным объектом прав доступа для системы является *ресурс*. Ресурсами могут быть папки, файлы, html-страницы, а так же их компоненты (например, отдельные пункты меню). Все ресурсы  можно разделить на два класса: *системные* и  *пользовтаельские*. Первый из них--объекты используемые собственно приложением и необходимые для его корректной работы. Доступ к таким ресурсам ограничен и возможен только в рамках *предустановленных* функциональных блоков (например, доступ к странице :ref:`createuser_label`: может быть установлен только вместе с соответствующей кнопкой меню администрирования, и соответственно доступом к администрированию в принципе). В то же время, для пользовательских ресурсов такого ограничения нет (т.е. функциональные блоки, содержащие эти ресурсы могут быть редактируемыми внешним администратором). Информацию о  типах ресурсов(html-страницы, пункты меню, файлы...) и их классах (пользовательские, системные) можно найти в таблицу **resourcetypes**. В таблице **resources** находятся ресурсы, структурированные в виде дерева (например, компоненты html-страниц находятся на самой странице а файлы--в папке). Доступ к ресурсам осуществляется также не напрямую, а посредством *функциональных блоков*. Функциональный блок представляет собой базовый набор ресурсов, отвечающих за единичный процесс. Например, функциональный блок "администрирование пользователей" включает в себя доступ к страницам создания и изменения пользователе и соответствующим компонентам меню. Функциональные блоки находятся в таблице **funcblocks**, в таблицах **funcblockresources** и **funcblockroles** представлена связь между ними и ресурсами и ролями соответственно. Наконец, в таблице **usersessions** хранятся данные пользовательских сессий.


