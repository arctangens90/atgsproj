
<!DOCTYPE html>

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Структура веб-сервера go &#8212; документация AtgsProject 1.1</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" />
    <link rel="next" title="Описание html-страниц" href="html.html" />
    <link rel="prev" title="Структура баз данных" href="db.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="go">
<h1>Структура веб-сервера go<a class="headerlink" href="#go" title="Ссылка на этот заголовок">¶</a></h1>
<div class="section" id="id1">
<h2>Общие положения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<p>Код приложения лежит в папе <strong>/cmd</strong>. На текущий момент реализованы 2 модуля: <strong>/log</strong> и <strong>/web</strong>, первый из которых отвечает за логирование, а второй– собственно за веб-сервер. Прочие модули, по мере написания, должны добавляться также в папку <strong>/cmd</strong>.</p>
</div>
<div class="section" id="loggo-label">
<span id="id2"></span><h2>Модуль логирования<a class="headerlink" href="#loggo-label" title="Ссылка на этот заголовок">¶</a></h2>
<p>Модуль логирования лежит в папке <strong>/log</strong> и реализован в файле <strong>log.go</strong>. В этой же папке находятся и сами логи. Файл <strong>log.go</strong> включает в себя объявление двух глобальных переменных-логов <a class="reference internal" href="#errlog">ErrLog</a> и <a class="reference internal" href="#infolog">InfoLog</a>,
первый из которых служит для записи информационных сообщений, второй – для записи ошибок. Определена также константа <a class="reference internal" href="#maxlogfiles">MAXLOGFILES</a> определяющая максимальное число лог-файлов в папке, а также две функции : <a class="reference internal" href="#setfilelogger">SetFileLogger</a> и <a class="reference internal" href="#checkcountlogs">CheckCountLogs</a>. <a class="reference internal" href="#setfilelogger">SetFileLogger</a> генерирует файл (или открывает существующий) по определенной маске, включающей в себя тип лога и текущее время, а <a class="reference internal" href="#checkcountlogs">CheckCountLogs</a> проверяет, не вышло ли число лог-файлов за предельное количество, и удаляет старые логи, если это произошло.</p>
<p>Таблица 1.1 Переменные и константы <strong>log.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 24%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Название переменной</p></th>
<th class="head"><p>Тип данных</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p id="errlog">ErrLog</p>
</td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> log.Logger</p></td>
<td><p>Логгер для ошибок</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="infolog">InfoLog</p>
</td>
<td><p><cite>*</cite> log.Logger</p></td>
<td><p>Логгер для информации</p></td>
</tr>
<tr class="row-even"><td><p id="maxlogfiles">MAXLOGFILES</p>
</td>
<td><p>int</p></td>
<td><p>Максимальное число логов в лог файлах</p></td>
</tr>
</tbody>
</table>
<p>Таблица 1.2 Функции и методы <strong>log.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 11%" />
<col style="width: 8%" />
<col style="width: 10%" />
<col style="width: 9%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="setfilelogger">SetFileLogger</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Создание логгера в файл</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>filename</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>Имя файла</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>prefix</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>Лог-префикс</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> log.logger</p></td>
<td><p>выходной</p></td>
<td><p>Результат</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="checkcountlogs">CheckCountLogs</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Удаление старых логов, если количество логов превышает допустимое</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>prefix</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>Лог-префикс</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="webgo-label">
<span id="id3"></span><h2>Веб-сервер<a class="headerlink" href="#webgo-label" title="Ссылка на этот заголовок">¶</a></h2>
<p>Логика самого веб-сервера находится в папке <em>/web</em>. В ней содержатся следующие файлы, каждый из которых будет рассмотрен подробнее:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#access-go">access.go</a></p></li>
<li><p><a class="reference internal" href="#auth-go">auth.go</a></p></li>
<li><p><a class="reference internal" href="#basictypes-go">basictypes.go</a></p></li>
<li><p><a class="reference internal" href="#conf-go">conf.go</a></p></li>
<li><p>config.json</p></li>
<li><p><a class="reference internal" href="#handlerscustom-go">handlersCustom.go</a></p></li>
<li><p><a class="reference internal" href="#handlersget-go">handlersGet.go</a></p></li>
<li><p><a class="reference internal" href="#handlerspost-go">handlersPost.go</a></p></li>
<li><p><a class="reference internal" href="#htmlhandler-go">htmlhandler.go</a></p></li>
<li><p><a class="reference internal" href="#main-go">main.go</a></p></li>
<li><p><a class="reference internal" href="#route-go">route.go</a></p></li>
</ul>
<div class="section" id="config-json">
<h3>Настройка конфигурационного файла config.json<a class="headerlink" href="#config-json" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом файле хранятся основные параметры конфигурации для работы веб-сервера, а именно хост, порт, где будет развернут веб-сервер, данные БД администрирования и данные дополнительных БД для получения данных.</p>
</div>
<div class="section" id="conf-go">
<span id="id4"></span><h3>Загрузка конфигурации. <strong>conf.go</strong><a class="headerlink" href="#conf-go" title="Ссылка на этот заголовок">¶</a></h3>
<p>Файл <strong>conf.go</strong> отвечает за загрузку конфигурации из конфигурационного файла. В нем описаны необходимые структуры для загрузки  <em>config.json</em> и его интерпретации, а также функции <a class="reference internal" href="#loadconfig">LoadConfig</a>, загружающая данные из конфигурационного файла, и <a class="reference internal" href="#applyconfig">ApplyConfig</a>, преобразующая загруженную структуру в набор мета-переменных.</p>
<p>Таблица 1.3 Типы и структуры <strong>conf.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Название типа/структуры</p></th>
<th class="head"><p>Поле</p></th>
<th class="head"><p>Тип</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="serverconfig">ServerConfig</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Конфигурация сокета для веб-сервера</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Host</p></td>
<td><p>string</p></td>
<td><p>Хост</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Port</p></td>
<td><p>string</p></td>
<td><p>Порт</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="dbconfig">DBConfig</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Конфигурация БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Host</p></td>
<td><p>string</p></td>
<td><p>Хост</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Port</p></td>
<td><p>string</p></td>
<td><p>Порт</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>User</p></td>
<td><p>string</p></td>
<td><p>Пользователь БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Password</p></td>
<td><p>string</p></td>
<td><p>Пароль</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>DBName</p></td>
<td><p>string</p></td>
<td><p>Название БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Ssl</p></td>
<td><p>string</p></td>
<td><p>Настройка ssl</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="otherdb">OtherDB</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Структура для хранения дополнительных баз данных</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>DBName</p></td>
<td><p>string</p></td>
<td><p>Название БД в программе</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>DBConfig</p></td>
<td><p><a class="reference internal" href="#dbconfig">DBConfig</a></p></td>
<td><p>Конфигурация БД</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="config">Config</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Общая структура для хранения конфигурации</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>ServerConfig</p></td>
<td><p><a class="reference internal" href="#serverconfig">ServerConfig</a></p></td>
<td><p>Конфигурация сервера</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>AdminDBConfig</p></td>
<td><p><a class="reference internal" href="#dbconfig">DBConfig</a></p></td>
<td><p>Конфигурация БД администрирования</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>OtherDB</p></td>
<td><p>[] <a class="reference internal" href="#otherdb">OtherDB</a></p></td>
<td><p>Конфигурации прочих БД</p></td>
</tr>
</tbody>
</table>
<p>Таблица 1.4 Функции и методы <strong>conf.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 13%" />
<col style="width: 9%" />
<col style="width: 11%" />
<col style="width: 10%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="loadconfig">LoadConfig</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Загрузка конфигурации из конфигурационного файла</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td><p><a class="reference internal" href="#config">Config</a></p></td>
<td><p>выходной</p></td>
<td><p>Конфигурационная структура</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="applyconfig">ApplyConfig</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Разбиение конфигурации на мета-переменные</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>cfg</p></td>
<td><p><a class="reference internal" href="#config">Config</a></p></td>
<td><p>входной</p></td>
<td><p>Конфигурационная структура</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>serverstring</p></td>
<td><p>string</p></td>
<td><p>выходной</p></td>
<td><p>Строка для создания веб-сервера</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>dbstring</p></td>
<td><p>string</p></td>
<td><p>выходной</p></td>
<td><p>Строка для коннекта к БД администирования</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>dbmap</p></td>
<td><p>map[string]string</p></td>
<td><p>выходной</p></td>
<td><p>Набор строк для подключения к прочим БД</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="basictypes-go">
<span id="id5"></span><h3>Вспомогательные структуры. <strong>basictypes.go</strong><a class="headerlink" href="#basictypes-go" title="Ссылка на этот заголовок">¶</a></h3>
<p>В файле <strong>basictypes.go</strong> находятся структуры языка go, используемые для различных служебных целей в программе. Структуры <a class="reference internal" href="#user">User</a> и <a class="reference internal" href="#role">Role</a> содержат полную информацию об авторизированном пользователе. Эти две структуры инкапсулируются в структуру <a class="reference internal" href="#userfulldata">UserFullData</a>, которая используется в программе как основа для взаимодействия пользователя с веб-сервером. Структура <a class="reference internal" href="#userproperties">UserProperties</a>, встроенная в <a class="reference internal" href="#user">User</a> содержит  вспомогательные данные пользовтаеля, не влияющие на логику системы (например, имя или телефон). Структура <a class="reference internal" href="#deplist">DepList</a> хранит информацию об отделе, а <a class="reference internal" href="#deptree">DepTree</a>–упорядоченный набор всех отделов. Структура <a class="reference internal" href="#createuser">CreateUser</a> нужна для создания нового пользователя. Структура <a class="reference internal" href="#session">Session</a> содержит основную информацию о текущей сессии. Наконец, структуры <a class="reference internal" href="#edithtml">Edithtml</a> и <a class="reference internal" href="#createhtml">CreateHtml</a> содержат набор необходимых индивидуальных параметров для загрузки соответсвующих html-страниц.</p>
<p>Таблица 1.5 Типы данных для <strong>basictypes.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 5%" />
<col style="width: 6%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Название типа данных</p></th>
<th class="head"><p>Поле</p></th>
<th class="head"><p>Тип</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="user">User</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Базовая структура, содержащая данные пользователя</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>UserIndex</p></td>
<td><p>int</p></td>
<td><p>Индекс пользователя в БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Login</p></td>
<td><p>string</p></td>
<td><p>Логин</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>DepIndex</p></td>
<td><p>int</p></td>
<td><p>Индекс отдела пользователя в БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>DepName</p></td>
<td><p>string</p></td>
<td><p>Название отдела</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>UserProperties</p></td>
<td><p><a class="reference internal" href="#userproperties">UserProperties</a></p></td>
<td><p>Прочие свойства пользователя</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="userproperties">UserProperties</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Свойства пользователя, не несущие системной логики</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>UserName</p></td>
<td><p>string</p></td>
<td><p>Имя пользовтаеля</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>UserSurname</p></td>
<td><p>string</p></td>
<td><p>Фамилия пользователя</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>UserMiddlename</p></td>
<td><p>string</p></td>
<td><p>Отчество пользователя</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Email</p></td>
<td><p>string</p></td>
<td><p>e-mail пользователя</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Phone</p></td>
<td><p>string</p></td>
<td><p>Телефон пользователя</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="createuser">CreateUser</p>
</td>
<td></td>
<td></td>
<td><p>Структура для создания пользователя в БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Login</p></td>
<td><p>string</p></td>
<td><p>Логин</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Password</p></td>
<td><p>string</p></td>
<td><p>Пароль</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>DepIndex</p></td>
<td><p>int</p></td>
<td><p>Индекс отдела в БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Properties</p></td>
<td><p><a class="reference internal" href="#userproperties">UserProperties</a></p></td>
<td><p>Прочие данные пользователя</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>AcceptedRoles</p></td>
<td><p>[]int</p></td>
<td><p>Набор индексов ролей, присваеваемых пользователю</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="deptree">DepTree</p>
</td>
<td></td>
<td><p>map[int] <a class="reference internal" href="#deplist">DepList</a></p></td>
<td><p>Дерево департаментов</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="deplist">DepList</p>
</td>
<td><p>UserMiddlename</p></td>
<td><p>struct</p></td>
<td><p>Структура, описывающая департамент</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>DepIndex</p></td>
<td><p>int</p></td>
<td><p>Индекс отдела в БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>DepName</p></td>
<td><p>string</p></td>
<td><p>Название отдела</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="role">Role</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Структура для описания ролей пользователя</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>RoleIndex</p></td>
<td><p>int</p></td>
<td><p>Индекс роли в БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>RoleName</p></td>
<td><p>string</p></td>
<td><p>Название роли</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>RoleFullname</p></td>
<td><p>string</p></td>
<td><p>Подробное описание роли</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="userfulldata">UserFullData</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Структура для хранения текущего пользователя и его роли</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>User</p></td>
<td><p><a class="reference internal" href="#user">User</a></p></td>
<td><p>Пользователь</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Role</p></td>
<td><p><a class="reference internal" href="#role">Role</a></p></td>
<td><p>Роль</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="session">Session</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Структура для хранения основных параметров сессиии</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>SessionIndex</p></td>
<td><p>string</p></td>
<td><p>Индекс сесии в БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>UserIndex</p></td>
<td><p>string</p></td>
<td><p>Индекс пользователя в БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>RoleIndex</p></td>
<td><p>string</p></td>
<td><p>Индекс роли в БД</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="createhtml">CreateHtml</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Набор индивидуальных настроек для загрузки страницы Createuser.html</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>DepTree</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> <a class="reference internal" href="#deptree">DepTree</a></p></td>
<td><p>Дерево департаментов</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>RoleList</p></td>
<td><p>[] <a class="reference internal" href="#role">Role</a></p></td>
<td><p>Список доступных ролей</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="edithtml">EditHtml</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Набор индивидуальных настроек для загрузки страницы Edituser.html</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>IsAdmin</p></td>
<td><p>bool</p></td>
<td><p>Переменная, определяющая тип редактирования: если значение <em>true</em>, то значит страница запрошена администратором для администрирования пользователей. Если <em>false</em> то пользователь входит в свой личный кабинет</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="main-go">
<span id="id6"></span><h3>Основная программа. <strong>main.go</strong><a class="headerlink" href="#main-go" title="Ссылка на этот заголовок">¶</a></h3>
<p>В главном файле <strong>main.go</strong> происходит собственно загрузка конфигурации, после чего устанавливается пул соединений со всеми нужными базами данных, формируется набор сессионных переменных и происходит запуск веб-сервера. Обработчики запросов вынесены в <strong>route.go</strong></p>
</div>
<div class="section" id="auth-go">
<span id="id7"></span><h3>Авторизация пользователя. <strong>auth.go</strong><a class="headerlink" href="#auth-go" title="Ссылка на этот заголовок">¶</a></h3>
<p>В файле <strong>auth.go</strong> сосредоточены функции для авторизации пользователя и загрузки и распределения сопутствующей информации. Функция <a class="reference internal" href="#getuserdata">GetUserData</a> получает из БД структуру <a class="reference internal" href="#userfulldata">UserFullData</a>
, т.е. информацию о пользователе и роли, с которой он авторизировался. Функция <a class="reference internal" href="#getdeptree">GetDepTree</a> получает список департаментов в сортировке, актуальной для данного пользователя (если пользователь сопоставлен отделу, он отображается первым, если нет–первым идет пункт «Департамент отсутствует»).Функции <a class="reference internal" href="#createsession">CreateSession</a> и <a class="reference internal" href="#closesession">CloseSession</a> создают и закрывают сессию соответственно. <a class="reference internal" href="#getsessionindex">GetSessionIndex</a> позволяет получить идентификатор сессии. Для работы с cookie используются функции <a class="reference internal" href="#createsessioncookies">CreateSessionCookies</a>, <a class="reference internal" href="#setsessioncookies">SetSessionCookies</a>, <a class="reference internal" href="#deletesessioncookies">DeleteSessionCookies</a>, Первые две используются для создания cookie и записи данных сессии в них, а последняя–для очистки cookies от этих данных. Наконец, функция <a class="reference internal" href="#cookie2int">Cookie2Int</a> нужна для преобразования строковых значений cookie в числа.</p>
<p>Таблица 1.6 Типы данных для <strong>auth.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 14%" />
<col style="width: 9%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="getuserdata">GetUserData</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Загрузка конфигурации из конфигурационного файла</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>UserLogin</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>Логин</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>RoleIndex</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс роли</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>UserData</p></td>
<td><p><a class="reference internal" href="#userfulldata">UserFullData</a></p></td>
<td><p>выходной</p></td>
<td><p>Полные данные пользователя и роли</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="getdeptree">GetDepTree</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Загрузка дерева отделов с учетом отдела пользователя</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>idep_index</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс отдела в БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>tree</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> <a class="reference internal" href="#deptree">DepTree</a></p></td>
<td><p>выходной</p></td>
<td><p>Дерево департаментов</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>err</p></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="createsession">CreateSession</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Создание сессии</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>UserIndex</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс пользователя</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>RoleIndex</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс роли</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>RemoteAddr</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>IP адрес пользователя</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>CurrentSession</p></td>
<td><p><a class="reference internal" href="#session">Session</a></p></td>
<td><p>выходной</p></td>
<td><p>Структура с данными сессии</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>err</p></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="setsessioncookies">SetSessionCookies</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Запись данных сессии в куки</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>SessionIndex</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс сессии</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>UserIndex</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс пользователя</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>RoleIndex</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс роли</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>responce</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="createsessioncookies">CreateSessionCookies</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Создание куки для хранения сессионных данных</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>Session</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> Session</p></td>
<td><p>входной</p></td>
<td><p>Структура с данными сесиии</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>responce</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="deletesessioncookies">DeleteSessionCookies</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Удаление куки с данными о сессии</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>responce</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="closesession">CloseSession</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Закрытие сессии</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>responce</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>request</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DBr</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>err</p></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="cookie2int">Cookie2Int</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Получение целочисленных куки в виде числа</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>request</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>CookieName</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>название куки</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Значение</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="getsessionindex">GetSessionIndex</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Получение индекса сессии</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>request</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Значение</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="access-go">
<span id="id8"></span><h3>Права доступа. <strong>access.go</strong><a class="headerlink" href="#access-go" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом файле находится логика для распределения прав доступа для разных пользователей. Ключевой элемент – структура <a class="reference internal" href="#accessmap">AccessMap</a> которая представляет собой карту, где ключами являются строки с названиями прав пользователей, а значения – true, что означает, что права на данный функционал доступны. (Конечно, можно было использовать массив или срез, но в таком случае могли бы быть дубликаты, кроме того карта лучше подходит по логике). Метод структуры <a class="reference internal" href="#accessmap">AccessMap</a> <a class="reference internal" href="#haspermission">HasPermission</a> проверяет, есть ли доступ к запрашиваемому функционалу. Именно эот метод применяется для динамической генерации html-страниц. Метод <a class="reference internal" href="#truncate">Truncate</a> позволяет полностью очистить матрицу прав доступа (например, при логауте). Функция <a class="reference internal" href="#write2accessmap">Write2AccessMap</a> нужна для заполнения <a class="reference internal" href="#accessmap">AccessMap</a> данными из БД. Функция <a class="reference internal" href="#getbasicaccessmap">GetBasicAccessMap</a> формирует базовый набор прав, доступный пользователя без привязки к конкретной странице (например, доступные элементы главного меню). Структуры <a class="reference internal" href="#accessmap">AccessMap</a> и <a class="reference internal" href="#userfulldata">UserFullData</a> составляют базовую структуру <a class="reference internal" href="#sessiondata">SessionData</a>, в которой инкапсулирована вся информация о пользователе, роли и его правах. Вместе же с набором баз данных <em>DBPool</em> они образуют структуру <a class="reference internal" href="#routedata">RouteData</a>, которая передается в обработчики событий, которые, в свою очередь, получают необходимую информацию из БД и динамически формируют ответы на http-запросы (например, геренрируют разный контент для html-страниц). Наконец, структура <a class="reference internal" href="#neuteredfilesystem">NeuteredFileSystem</a> вместе с методом <a class="reference internal" href="#open">Open</a> создают защищенный обработчик файлов (например, чтобы не была видна файловая структура папки <strong>/static</strong> сервера). На текущий момент, для удобства отладки, эта функция предстовляет из себя заглушку, однако в дальнейшем будет переписана.</p>
<p>Таблица 1.7. Типы данных для <strong>access.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 11%" />
<col style="width: 10%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Название типа/структуры</p></th>
<th class="head"><p>Поле</p></th>
<th class="head"><p>Тип</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="accessmap">AccessMap</p>
</td>
<td></td>
<td><p>map[string]bool</p></td>
<td><p>Матрица прав доступа. В карте ключами являются доступные права (строки-названия), а значениями значения <em>true</em></p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="sessiondata">SessionData</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Необходимый набор значений для сессии– информация о пользовтаеле, роли и правах</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>UserData</p></td>
<td><p><a class="reference internal" href="#userfulldata">UserFullData</a></p></td>
<td><p>Данные пользвателя и роли</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>BasicAcceptedObjects</p></td>
<td><p><a class="reference internal" href="#accessmap">AccessMap</a></p></td>
<td><p>Список глобальных доступных объектов</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="routedata">RouteData</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Структура для переачи в маршрутизатор</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>SessionData</p></td>
<td><p><a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>Необходимые данные сессии</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>DBPool</p></td>
<td><p>map[string]*sql.DB</p></td>
<td><p>Необходимый набор БД</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="neuteredfilesystem">NeuteredFileSystem</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Защищенный обработчик файлов</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Fs</p></td>
<td><p>http.FileSystem</p></td>
<td><p>Коллекция файлов</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>SData</p></td>
<td><p><a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>Данные сессии</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td><p>БД</p></td>
</tr>
</tbody>
</table>
<p>Таблица 1.8 Функции и методы <strong>access.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 12%" />
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="haspermission">HasPermission</p>
</td>
<td><p><a class="reference internal" href="#accessmap">AccessMap</a>
<a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td></td>
<td></td>
<td></td>
<td><p>Проверка, есть ли право доступа на определенный объект</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>s</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>Название проверяемого объекта</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td><p>bool</p></td>
<td><p>выходной</p></td>
<td><p>Результат</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="truncate">Truncate</p>
</td>
<td><p><a class="reference internal" href="#accessmap">AccessMap</a></p></td>
<td></td>
<td></td>
<td></td>
<td><p>Очищает матрицу прав доступа</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="open">Open</p>
</td>
<td><p><a class="reference internal" href="#neuteredfilesystem">NeuteredFileSystem</a></p></td>
<td></td>
<td></td>
<td></td>
<td><p>Реализация стандартного go-интерфейса для работы защищенного обработчика</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>path</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>Путь к файлу</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td><p>http.File</p></td>
<td><p>выходной</p></td>
<td><p>Файл для открытия</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="write2accessmap">Write2AccessMap</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Заполнение матрицы прав доступа</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>am</p></td>
<td><p><a class="reference internal" href="#accessmap">AccessMap</a></p></td>
<td><p>входной</p></td>
<td><p>Матрица прав доступа</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>sql_query</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>Запрос для получения прав</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>queryargs</p></td>
<td><p>interface{}</p></td>
<td><p>входной</p></td>
<td><p>Параметры запроса</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>err</p></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="getbasicaccessmap">GetBasicAccessMap</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Загрузка прав доступа к общим объектам для конкретной роли</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>am</p></td>
<td><p><a class="reference internal" href="#accessmap">AccessMap</a></p></td>
<td><p>входной</p></td>
<td><p>Матрица прав доступа</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>RoleIndex</p></td>
<td><p>int</p></td>
<td><p>входной</p></td>
<td><p>Индекс роли из БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>err</p></td>
<td><p>error</p></td>
<td><p>выходной</p></td>
<td><p>Ошибка</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="route-go">
<span id="id9"></span><h3>Обработчики событий.<a class="headerlink" href="#route-go" title="Ссылка на этот заголовок">¶</a></h3>
<div class="section" id="id10">
<h4>Обработка запросов. <strong>route.go</strong><a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h4>
<p>Маршрутизация приложения описана в файле <strong>route.go</strong>. По сути, здесь описано какие функции нужно выполнять для определенных http-запросов.Фактически, это и есть основная функция, реализуемая веб-сервером. Детализация функций-обработчиков рассмотрена в файлах <strong>handlersCustom.go</strong>, <strong>handlersGet.go</strong>, <strong>handlersPut.go</strong> и  <strong>htmlhandler.go</strong></p>
<p>Таблица 1.9 Переменные в <strong>route.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 9%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Название переменной</p></th>
<th class="head"><p>Тип данных</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HeadersTmpl</p></td>
<td><p>[]string</p></td>
<td><p>Набор стандартных шаблонов для загрузки большинства веб-страниц (левое и верхние меню и т.п.)</p></td>
</tr>
</tbody>
</table>
<p>Таблица 1.10 Функции и методы <strong>route.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 13%" />
<col style="width: 10%" />
<col style="width: 14%" />
<col style="width: 11%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="routes">routes</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Функция, прописывающая маршруты по http-запросам</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> <a class="reference internal" href="#routedata">RouteData</a></p></td>
<td><p>входной</p></td>
<td><p>Исходные данные для маршрутизатора</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.ServeMux</p></td>
<td><p>выходной</p></td>
<td><p>Маршрутизатор go</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="html-htmlhandler-go">
<span id="htmlhandler-go"></span><h4>Стандартный генератор html-страниц. <strong>htmlhandler.go</strong><a class="headerlink" href="#html-htmlhandler-go" title="Ссылка на этот заголовок">¶</a></h4>
<p>В большинстве своем, если результатом запроса должна быть html-страница, то функция, реализующая подобный обработчик должна работать по определенному алгоритму: сначала проходит проверка матрицы прав доступа на предмет самой возможности доступа к этой странице. Затем, в случае отрицательного ответа, должен вызываться некоторый обработчик, сигнализирующий об отсутсвии прав, а в случае положительного ответа должен  выполняться повторный запрос в БД для определения прав доступа к отдельным элементам этой страницы, в результате чего происходит уже генерация html-страницы на основе доступных элементов. Именно такой функционал реализован структурой <a class="reference internal" href="#htmlhandler">HtmlHandler</a> в файле <strong>htmlhandlers.go</strong>.  В основе <a class="reference internal" href="#htmlhandler">HtmlHandler</a> лежит структура <a class="reference internal" href="#htmlobjects">HtmlObjects</a> куда входят структуры <a class="reference internal" href="#sessiondata">SessionData</a>  и <a class="reference internal" href="#acceptedobjects">AcceptedObjects</a>, несущие в себе информацию о пользователе и его правах (причем, структура <a class="reference internal" href="#acceptedobjects">AcceptedObjects</a> содержит в себе права относящиеся непосредственно к запрашиваемой html, а в <a class="reference internal" href="#sessiondata">SessionData</a> входят права пользователя на глобальные объекты) , структура <a class="reference internal" href="#pagemeta">PageMeta</a> с мета-данными страницы, а также интерфейс <a class="reference internal" href="#commonobjects">CommonObjects</a> в котором могут быть произвольные объекты, индивидуальные для каждой страницы, которые нужны для ее корректной генерации. (Например, для страницы создания пользователя <a class="reference internal" href="html.html#createuser-label"><span class="std std-ref">сreateuser.html</span></a>: это списки доступных отделов и ролей). Конечно, можно генерацию страниц проводить и на уровне скриптов javascript, динамически заполняя существующие поля, однако, в случае, если элемент статичен и берется из внешнего источника, имеет смысл генерация именно через шаблонизатор go. Также в структуру <a class="reference internal" href="#htmlhandler">HtmlHandler</a> входят обработчик событий на случай отсутсвия прав доступа к запрашиваемой странице, название генерируемой html, список шаблонов для ее генерации и ссылка на БД. Посредством методов <a class="reference internal" href="#htmlhandler">HtmlHandler</a> и <a class="reference internal" href="#accesshandler">AccessHandler</a> данная структура  реализует  описанный в  начале алгоритм.</p>
<p>Таблица 1.11 Типы и структуры <strong>htmlhandler.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 11%" />
<col style="width: 23%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Название типа/структуры</p></th>
<th class="head"><p>Поле</p></th>
<th class="head"><p>Тип</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="pagemeta">PageMeta</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Мета-данные страницы</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>PageName</p></td>
<td><p>string</p></td>
<td><p>Название</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>PageHttp</p></td>
<td><p>string</p></td>
<td><p>http-запрос для отображения</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>PageDescribe</p></td>
<td><p>string</p></td>
<td><p>Краткое описание</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>PageLogoClass</p></td>
<td><p>string</p></td>
<td><p>Тип логотипа</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="htmlobjects">HtmlObjects</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Набор объектов необходимый для динамической генерации html-страницы</p></td>
</tr>
<tr class="row-even"><td></td>
<td><blockquote>
<div></div></blockquote>
<p id="commonobjects">CommonObjects</p>
</td>
<td><p>interface{}</p></td>
<td><p>Набор индивидуальных объектов для страницы</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>SessionData</p></td>
<td><p><a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>Общие данные сессии</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p id="acceptedobjects">AcceptedObjects</p>
</td>
<td><p><a class="reference internal" href="#accessmap">AccessMap</a></p></td>
<td><p>Набор прав доступа на индивидуальные объекты страницы</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>PageMeta</p></td>
<td><p><a class="reference internal" href="#pagemeta">PageMeta</a></p></td>
<td><p>Мета-данные страницы</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="htmlhandler">HtmlHandler</p>
</td>
<td></td>
<td><p>struct</p></td>
<td><p>Универсальная структура для генерации html-страниц согласно матрице прав доступа</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>DenyHandler</p></td>
<td><p>func(http.ResponseWriter, <code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request)</p></td>
<td><p>Обработчик события в случае отсутствии прав на отображение страницы</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>SourceHtml</p></td>
<td><p>string</p></td>
<td><p>Имя генерируемой html-страницы (как в БД) для загрузки прав доступа на объекты внутри страницы</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>PathSourceHtml</p></td>
<td><p>[]string</p></td>
<td><p>Набор путей для загрузки необходимых шаблонов и html-страниц в go</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>HtmlData</p></td>
<td><p><a class="reference internal" href="#htmlobjects">HtmlObjects</a></p></td>
<td><p>Данные для динамической генерации страницы</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td><p>БД</p></td>
</tr>
</tbody>
</table>
<p>Таблица 1.12 Функции и методы <strong>htmlhandler.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 11%" />
<col style="width: 8%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="denyhandler">HtmlHandle</p>
</td>
<td><p><a class="reference internal" href="#htmlhandler">HtmlHandler</a></p></td>
<td></td>
<td></td>
<td></td>
<td><p>Общий обработчик события на http-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="accesshandler">AccesHandler</p>
</td>
<td><p><a class="reference internal" href="#htmlhandler">HtmlHandler</a></p></td>
<td></td>
<td></td>
<td></td>
<td><p>Обработчик события на http-запрос при успешной проверке прав доступа на html-страницу</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="handlerscustom-go">
<span id="id11"></span><h4>Специфические обработчики событий. <strong>handlersCustom.go</strong><a class="headerlink" href="#handlerscustom-go" title="Ссылка на этот заголовок">¶</a></h4>
<p>В файле <strong>handlersCustom.go</strong> описаны обработчики событий, которые не подлежат адекватной группировке с остальными. Сюда относится генератор главной страницы и формы авторизации, а также обработчики для входа/выхода из системы. Первые два просто генерируют нужные html-страницы. Обработчик авторизации <a class="reference internal" href="#loginhandler">LoginHandler</a> проверяет корректность пары логин-пароль и, в случае успешной авторизации, открывает новую сессию и заполняет базовую матрицу прав доступа для пользовтаеля с учетом его выбранной роли. В конечном итоге происходит перенаправление на главную страницу. Обработчик выхода <a class="reference internal" href="#logouthandler">LogoutHandler</a>  закрывает сессию, стирает данные пользователя и очищает матрицу прав доступа, после чего происходит переход на главную страницу.</p>
<p>Таблица 1.13 Функции и методы <strong>handlersCustom.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 11%" />
<col style="width: 9%" />
<col style="width: 13%" />
<col style="width: 9%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="denyhandle">DenyHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Общий обработчик события на http-запрос при отказе доступа</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="indexhandler">IndexHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Показ главной страницы</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>sd</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> <a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>входной</p></td>
<td><p>параметры сессии</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="authhandler">AuthHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Показ страницы авторизации</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>sd</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> <a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>входной</p></td>
<td><p>параметры сессии</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div><blockquote id="loginhandler">
<div></div></blockquote>
</div></blockquote>
<p id="login">LoginHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Авторизация пользователя в системе</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code>  sql.DB</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>sd</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> <a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>входной</p></td>
<td><p>параметры сессии</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="logouthandler">LogoutHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Выход пользователя из системы</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code>  sql.DB</p></td>
<td><p>входной</p></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>sd</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> <a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>входной</p></td>
<td><p>параметры сессии</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="get-handlersget-go">
<span id="handlersget-go"></span><h4>Обработчики get-запросов. <strong>handlersGet.go</strong><a class="headerlink" href="#get-handlersget-go" title="Ссылка на этот заголовок">¶</a></h4>
<p>Файл <strong>handlersGet.go</strong> состоит из набора функций, обеспечивающих ответ на get-запросы к веб-серверу. Большинство из них нужны для интерактивной работы html-страниц и служат источником для ajax-запросов из соответствующих скриптов. Основная функция-шаблон для получения информации из БД это <a class="reference internal" href="#jsonfromsqlfunchandler">JsonFromSqlFuncHandler</a> которая возвращает из базы данных json в ответ на некоторый запрос (<strong>важно</strong>: корректность формируемого json, равно как и то, что БД формирует именно json  не проверяется на этом уровне. Проверяется лишь сам факт корректного ответа от БД). По этому шаблону работают функции <a class="reference internal" href="#getroleshandler">GetRolesHandler</a>, <a class="reference internal" href="#getnoroleshandler">GetNoRolesHandler</a>, <a class="reference internal" href="#getallroleshandler">GetAllRolesHandler</a>, <a class="reference internal" href="#getusershandler">GetUsersHandler</a>, <a class="reference internal" href="#getdephandler">GetDepHandler</a> (первые три нужны для получения ролей, присвоенных и неприсвоенных пользователю соответственно, третья–для получения всех доступных ролей, а последние две–получение списка пользователей и департаментов). По этому же приниципу работают функции, получающие данные для тестовых страниц с таблицами из тестовой БД (Якутии).</p>
<p>Таблица 1.14 Функции и методы <strong>handlersGet.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 11%" />
<col style="width: 8%" />
<col style="width: 14%" />
<col style="width: 12%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="jsonfromsqlfunchandler">JsonFromSqlFuncHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Загрузка JSON из БД через SQL-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>querystr</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>SQL-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>queryargs</p></td>
<td><p>…interface{}</p></td>
<td><p>входной</p></td>
<td><p>параметры SQL-запроса</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="getroleshandler">GetRolesHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Получение списка присвоенных пользователю ролей</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="getnoroleshandler">GetNoRolesHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Получение списка неприсвоенных пользователю ролей</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="getallroleshandler">GetAllRolesHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Получение списка всех ролей</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="getusershandler">GetUsersHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Получение списка всех пользователей</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="getdephandler">GetDepHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Получение списка всех отделов</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="post-handlerspost-go">
<span id="handlerspost-go"></span><h4>Обработчики post-запросов. <strong>handlersPost.go</strong><a class="headerlink" href="#post-handlerspost-go" title="Ссылка на этот заголовок">¶</a></h4>
<p>Аналогично, файл <strong>handlersPost.go</strong> содержит функции для ответа на post-запросы. Стандартная функция-шаблон здесь <a class="reference internal" href="#savejson2dbhandler">SaveJson2DbHandler</a> позволяющая сохранить json в БД (<strong>важно</strong> корректность json на этом уровне не проверяется). По этому принципу реализован обработчик смены пароля пользовтаелем <a class="reference internal" href="#changepasswordbyuserhandler">ChangePasswordByUserHandler</a>, а также тестовые функции для сохранения суточных и часовых данных. Функции <a class="reference internal" href="#editaccepthandler">EditAcceptHandler</a> и <a class="reference internal" href="#createaccepthandler">CreateAcceptHandler</a> несут несколько более сложную логику. <a class="reference internal" href="#createaccepthandler">CreateAcceptHandler</a> проверяет входящий json и отсекает пустые поля (актуально для <a class="reference internal" href="#userproperties">UserProperties</a>). Для функции <a class="reference internal" href="#editaccepthandler">EditAcceptHandler</a> важен еще и источник редактирования: это может быть как редактирование пользователем своих личных данных, так и редактирвоание администратором других пользовтаелей. В первом случае, помимо сохранения изменений в БД необходимо обновить данные пользовтаеля в сессии. Наконец, <a class="reference internal" href="#updateuserroleshandler">UpdateUserRolesHandler</a> позволяет обновить доступные пользователем роли, но в отличие от <a class="reference internal" href="#savejson2dbhandler">SaveJson2DbHandler</a> , который возвращает только ошибку, она возвращает количество добавленных и удаленных ролей (в целом, это нужно для отладки, в перспективе можно убрать и привести к стандарту).</p>
<p>Таблица 1.15 Функции и методы <strong>handlersPost.go</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 11%" />
<col style="width: 10%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Названия функции/метода</p></th>
<th class="head"><p>Структура-источник</p></th>
<th class="head"><p>Имя параметра</p></th>
<th class="head"><p>Тип параметра</p></th>
<th class="head"><p>Класс параметра</p></th>
<th class="head"><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="savejson2dbhandler">SaveJson2DbHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Сохранение JSON в БД через SQL-запрос (выполнение функции)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>query</p></td>
<td><p>string</p></td>
<td><p>входной</p></td>
<td><p>SQL-запрос</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div></div></blockquote>
<p id="editaccepthandler">EditAcceptHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Сохранение изменений пользователя в БД</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>sData</p></td>
<td><p><a class="reference internal" href="#sessiondata">SessionData</a></p></td>
<td><p>входной</p></td>
<td><p>параметры сессии</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="createaccepthandler">CreateAcceptHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Создание пользователя в БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="updateuserroleshandler">UpdateUserRolesHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Изменение ролей пользователя в БД</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
<tr class="row-even"><td><blockquote>
<div></div></blockquote>
<p id="changepasswordbyuserhandler">ChangePasswordByUserHandler</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Изменение пароля пользователя в БД самим пользователем</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>w</p></td>
<td><p>http.ResponseWriter</p></td>
<td><p>входной</p></td>
<td><p>ответ на http-запрос</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>r</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> http.Request</p></td>
<td><p>входной</p></td>
<td><p>http запрос</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td><p>db</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code> sql.DB</p></td>
<td></td>
<td><p>БД</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">AtgsProject</a></h1>








<h3>Навигация</h3>
<p class="caption"><span class="caption-text">Оглавление:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="header.html">Общая структура проекта</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Структура баз данных</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Структура веб-сервера go</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Общие положения</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loggo-label">Модуль логирования</a></li>
<li class="toctree-l2"><a class="reference internal" href="#webgo-label">Веб-сервер</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#config-json">Настройка конфигурационного файла config.json</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conf-go">Загрузка конфигурации. <strong>conf.go</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#basictypes-go">Вспомогательные структуры. <strong>basictypes.go</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-go">Основная программа. <strong>main.go</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#auth-go">Авторизация пользователя. <strong>auth.go</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#access-go">Права доступа. <strong>access.go</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#route-go">Обработчики событий.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">Обработка запросов. <strong>route.go</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#html-htmlhandler-go">Стандартный генератор html-страниц. <strong>htmlhandler.go</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#handlerscustom-go">Специфические обработчики событий. <strong>handlersCustom.go</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-handlersget-go">Обработчики get-запросов. <strong>handlersGet.go</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-handlerspost-go">Обработчики post-запросов. <strong>handlersPost.go</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="html.html">Описание html-страниц</a></li>
<li class="toctree-l1"><a class="reference internal" href="js.html">Описание модулей javascript</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="db.html" title="предыдущая глава">Структура баз данных</a></li>
      <li>Next: <a href="html.html" title="следующая глава">Описание html-страниц</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Быстрый поиск</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Искать" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Terekhov Georgy.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/backend.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>